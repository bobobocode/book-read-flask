<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<title>The Application Context</title>
<style type="text/css">

/* Minimal style sheet for the HTML output of Docutils.                    */
/*                                                                         */
/* :Author: Günter Milde, based on html4css1.css by David Goodger          */
/* :Id: $Id: minimal.css 9079 2022-06-19 14:00:56Z milde $                                                               */
/* :Copyright: © 2015, 2021 Günter Milde.                                  */
/* :License: Released under the terms of the `2-Clause BSD license`_,      */
/*    in short:                                                            */
/*                                                                         */
/*    Copying and distribution of this file, with or without modification, */
/*    are permitted in any medium without royalty provided the copyright   */
/*    notice and this notice are preserved.                                */
/*                                                                         */
/*    This file is offered as-is, without any warranty.                    */
/*                                                                         */
/* .. _2-Clause BSD license: http://www.spdx.org/licenses/BSD-2-Clause     */

/* This CSS3 stylesheet defines rules for Docutils elements without        */
/* HTML equivalent. It is required to make the document semantics visible. */
/*                                                                         */
/* .. _validates: http://jigsaw.w3.org/css-validator/validator$link        */

/* titles */
p.topic-title,
p.admonition-title,
p.system-message-title {
  font-weight: bold;
}
p.sidebar-title,
p.rubric {
  font-weight: bold;
  font-size: larger;
}
p.rubric {
  color: maroon;
}
p.subtitle,
p.section-subtitle,
p.sidebar-subtitle {
  font-weight: bold;
  margin-top: -0.5em;
}
h1 + p.subtitle {
  font-size: 1.6em;
}
a.toc-backref {
  color: inherit;
  text-decoration: none;
}

/* Warnings, Errors */
.system-messages h2,
.system-message-title,
span.problematic {
  color: red;
}

/* Inline Literals */
.docutils.literal {
  font-family: monospace;
  white-space: pre-wrap;
}
/* do not wrap at hyphens and similar: */
.literal > span.pre { white-space: nowrap; }

/* Lists */

/* compact and simple lists: no margin between items */
.simple  li, .simple  ul, .simple  ol,
.compact li, .compact ul, .compact ol,
.simple  > li p, dl.simple  > dd,
.compact > li p, dl.compact > dd {
  margin-top: 0;
  margin-bottom: 0;
}
/* Nested Paragraphs */
p:first-child { margin-top: 0; }
p:last-child { margin-bottom: 0; }
details > p:last-child { margin-bottom: 1em; }

/* Table of Contents */
.contents ul.auto-toc { /* section numbers present */
  list-style-type: none;
}

/* Enumerated Lists */
ol.arabic     { list-style: decimal }
ol.loweralpha { list-style: lower-alpha }
ol.upperalpha { list-style: upper-alpha }
ol.lowerroman { list-style: lower-roman }
ol.upperroman { list-style: upper-roman }

/* Definition Lists and Derivatives */
dt .classifier { font-style: italic }
dt .classifier:before {
  font-style: normal;
  margin: 0.5em;
  content: ":";
}
/* Field Lists and similar */
/* bold field name, content starts on the same line */
dl.field-list,
dl.option-list,
dl.docinfo {
  display: flow-root;
}
dl.field-list > dt,
dl.option-list > dt,
dl.docinfo > dt {
  font-weight: bold;
  clear: left;
  float: left;
  margin: 0;
  padding: 0;
  padding-right: 0.2em;
}
/* Offset for field content (corresponds to the --field-name-limit option) */
dl.field-list > dd,
dl.option-list > dd,
dl.docinfo > dd {
  margin-left:  9em; /* ca. 14 chars in the test examples, fit all Docinfo fields */
}
/* start nested lists on new line */
dd > dl:first-child,
dd > ul:first-child,
dd > ol:first-child {
  clear: left;
}
/* start field-body on a new line after long field names */
dl.field-list > dd > *:first-child,
dl.option-list > dd > *:first-child
{
  display: inline-block;
  width: 100%;
  margin: 0;
}

/* Bibliographic Fields (docinfo) */
dl.docinfo pre.address {
  font: inherit;
  margin: 0.5em 0;
}
dl.docinfo > dd.authors > p { margin: 0; }

/* Option Lists */
dl.option-list > dt { font-weight: normal; }
span.option { white-space: nowrap; }

/* Footnotes and Citations  */

.footnote, .citation { margin: 1em 0; } /* default paragraph skip (Firefox) */
/* hanging indent */
.citation { padding-left: 2em; }
.footnote { padding-left: 1.7em; }
.footnote.superscript { padding-left: 1.0em; }
.citation > .label { margin-left: -2em; }
.footnote > .label { margin-left: -1.7em; }
.footnote.superscript > .label { margin-left: -1.0em; }

.footnote > .label + *,
.citation > .label + * {
  display: inline-block;
  margin-top: 0;
  vertical-align: top;
}
.footnote > .backrefs + *,
.citation > .backrefs + * {
  margin-top: 0;
}
.footnote > .label + p, .footnote > .backrefs + p,
.citation > .label + p, .citation > .backrefs + p {
  display: inline;
  vertical-align: inherit;
}

.backrefs { user-select: none; }
.backrefs > a { font-style: italic; }

/* superscript footnotes */
a[role="doc-noteref"].superscript,
.footnote.superscript > .label,
.footnote.superscript > .backrefs {
  vertical-align: super;
  font-size: smaller;
  line-height: 1;
}
a[role="doc-noteref"].superscript > .fn-bracket,
.footnote.superscript > .label > .fn-bracket {
  /* hide brackets in display but leave for copy/paste */
  display: inline-block;
  width: 0;
  overflow: hidden;
}
[role="doc-noteref"].superscript + [role="doc-noteref"].superscript {
  padding-left: 0.15em; /* separate consecutive footnote references */
  /* TODO: unfortunately, "+" also selects with text between the references. */
}

/* Alignment */
.align-left   {
  text-align: left;
  margin-right: auto;
}
.align-center {
  text-align: center;
  margin-left: auto;
  margin-right: auto;
}
.align-right  {
  text-align: right;
  margin-left: auto;
}
.align-top    { vertical-align: top; }
.align-middle { vertical-align: middle; }
.align-bottom { vertical-align: bottom; }

/* reset inner alignment in figures and tables */
figure.align-left, figure.align-right,
table.align-left, table.align-center, table.align-right {
  text-align: inherit;
}

/* Text Blocks */
.topic { margin: 1em 2em; }
.sidebar,
.admonition,
.system-message {
  margin: 1em 2em;
  border: thin solid;
  padding: 0.5em 1em;
}
div.line-block { display: block; }
div.line-block div.line-block, pre { margin-left: 2em; }

/* Code line numbers: dropped when copying text from the page */
pre.code .ln { display: none; }
pre.code code:before {
  content: attr(data-lineno); /* …, none) fallback not supported by any browser */
  color: gray;
}

/* Tables */
table {
  border-collapse: collapse;
}
td, th {
  border: thin solid silver;
  padding: 0 1ex;
}
.borderless td, .borderless th {
  border: 0;
  padding: 0;
  padding-right: 0.5em /* separate table cells */
}

table > caption {
  text-align: left;
  margin-top: 0.2em;
  margin-bottom: 0.2em;
}
table.captionbelow {
  caption-side: bottom;
}

/* Document Header and Footer */
header { border-bottom: 1px solid black; }
footer { border-top: 1px solid black; }

/* Images are block-level by default in Docutils */
/* New HTML5 block elements: set display for older browsers */
img, header, footer, main, aside, nav, section, figure, video, details {
  display: block;
}
/* inline images */
p img, p video, figure img, figure video {
  display: inline;
}

</style>
<style type="text/css">

/* CSS31_ style sheet for the output of Docutils HTML writers.             */
/* Rules for easy reading and pre-defined style variants.                  */
/*                                                                         */
/* :Author: Günter Milde, based on html4css1.css by David Goodger          */
/* :Id: $Id: plain.css 9081 2022-06-19 20:23:12Z milde $                                                               */
/* :Copyright: © 2015 Günter Milde.                                        */
/* :License: Released under the terms of the `2-Clause BSD license`_,      */
/*    in short:                                                            */
/*                                                                         */
/*    Copying and distribution of this file, with or without modification, */
/*    are permitted in any medium without royalty provided the copyright   */
/*    notice and this notice are preserved.                                */
/*                                                                         */
/*    This file is offered as-is, without any warranty.                    */
/*                                                                         */
/* .. _2-Clause BSD license: http://www.spdx.org/licenses/BSD-2-Clause     */
/* .. _CSS3: https://www.w3.org/Style/CSS/                                 */


/* Document Structure */
/* ****************** */

/* "page layout" */
body {
  margin: 0;
  background-color: #dbdbdb;
  --field-indent: 9em; /* default indent of fields in field lists */
}
main, footer, header {
  line-height:1.6;
  /* avoid long lines --> better reading */
  /* optimum is 45…75 characters/line <http://webtypography.net/2.1.2> */
  /* OTOH: lines should not be too short because of missing hyphenation, */
  max-width: 50rem;
  padding: 1px 2%; /* 1px on top avoids grey bar above title (mozilla) */
  margin: auto;
}
main {
  counter-reset: table figure;
  background-color: white;
}
footer, header {
  font-size: smaller;
  padding: 0.5em 2%;
  border: none;
}

/* Table of Contents */
ul.auto-toc > li > p {
  padding-left: 1em;
  text-indent: -1em;
}
nav.contents ul {
  padding-left: 1em;
}
main > nav.contents ul ul ul ul:not(.auto-toc) {
  list-style-type: '\2B29\ ';
}
main > nav.contents ul ul ul ul ul:not(.auto-toc) {
  list-style-type: '\2B1D\ ';
}

/* Transitions */
hr.docutils {
  width: 80%;
  margin-top: 1em;
  margin-bottom: 1em;
  clear: both;
}

/* Paragraphs */

/* vertical space (parskip) */
p, ol, ul, dl, li,
div.line-block,
.footnote, .citation,
div > math,
table {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

h1, h2, h3, h4, h5, h6,
dd, details > p:last-child {
  margin-bottom: 0.5em;
}

/* Lists */
/* ===== */

/* Definition Lists */
/* Indent lists nested in definition lists */
dd > ul:only-child, dd > ol:only-child { padding-left: 1em; }

/* Description Lists */
/* styled like in most dictionaries, encyclopedias etc. */
dl.description {
  display: flow-root;
}
dl.description > dt {
  font-weight: bold;
  clear: left;
  float: left;
  margin: 0;
  padding: 0;
  padding-right: 0.3em;
}
dl.description > dd:after {
  display: table;
  content: "";
  clear: left; /* clearfix for empty descriptions */
}

/* Field Lists */

dl.field-list > dd,
dl.docinfo > dd {
  margin-left: var(--field-indent); /* adapted in media queries or HTML */
}

/* example for custom field-name width */
dl.field-list.narrow > dd {
  --field-indent: 5em;
}
/* run-in: start field-body on same line after long field names */
dl.field-list.run-in > dd p {
  display: block;
}

/* Bibliographic Fields */

/* generally, bibliographic fields use dl.docinfo */
/* but dedication and abstract are placed into divs */
div.abstract p.topic-title {
  text-align: center;
}
div.dedication {
  margin: 2em 5em;
  text-align: center;
  font-style: italic;
}
div.dedication p.topic-title {
  font-style: normal;
}

/* disclosures */
details { padding-left: 1em; }
summary { margin-left: -1em; }

/* Text Blocks */
/* =========== */

/* Literal Blocks */
pre.literal-block, pre.doctest-block,
pre.math, pre.code {
  font-family: monospace;
}

/* Block Quotes and Topics */
bockquote { margin: 1em 2em; }
blockquote p.attribution,
.topic p.attribution {
  text-align: right;
  margin-left: 20%;
}

/* Tables */
/* ====== */

/* th { vertical-align: bottom; } */

table tr { text-align: left; }

/* "booktabs" style (no vertical lines) */
table.booktabs {
  border: 0;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.booktabs * {
  border: 0;
}
table.booktabs th {
  border-bottom: thin solid;
}

/* numbered tables (counter defined in div.document) */
table.numbered > caption:before {
  counter-increment: table;
  content: "Table " counter(table) ": ";
  font-weight: bold;
}

/* Explicit Markup Blocks */
/* ====================== */

/* Footnotes and Citations */
/* ----------------------- */

/* line on the left */
.footnote-list {
  border-left: solid thin;
  padding-left: 0.25em;
}

/* Directives */
/* ---------- */

/* Body Elements */
/* ~~~~~~~~~~~~~ */

/* Images and Figures */

/* let content flow to the side of aligned images and figures */
figure.align-left,
img.align-left,
video.align-left,
object.align-left {
  clear: left;
  float: left;
  margin-right: 1em;
}
figure.align-right,
img.align-right,
video.align-right,
object.align-right {
  clear: right;
  float: right;
  margin-left: 1em;
}
/* Stop floating sidebars, images and figures */
h1, h2, h3, h4, footer, header { clear: both; }

/* Numbered figures */
figure.numbered > figcaption > p:before {
  counter-increment: figure;
  content: "Figure " counter(figure) ": ";
  font-weight: bold;
}

/* Admonitions and System Messages */
.caution p.admonition-title,
.attention p.admonition-title,
.danger p.admonition-title,
.error p.admonition-title,
.warning p.admonition-title,
div.error {
  color: red;
}

/* Sidebar */
/* Move right. In a layout with fixed margins, */
/* it can be moved into the margin.            */
aside.sidebar {
  width: 30%;
  max-width: 26em;
  float: right;
  clear: right;
  margin-left: 1em;
  margin-right: -1%;
  background-color: #fffffa;
}


/* Code */
pre.code { padding: 0.7ex }
pre.code, code { background-color: #eeeeee }
/* basic highlighting: for a complete scheme, see */
/* https://docutils.sourceforge.io/sandbox/stylesheets/ */
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

/* Math */
/* for math-output=MathML (for math-output=HTML, see math.css) */
math .boldsymbol {
  font-weight: bold;
}
mstyle.mathscr, mi.mathscr {
  font-family: STIX;
}

/* Epigraph           */
/* Highlights         */
/* Pull-Quote         */
/* Compound Paragraph */
/* Container          */

/* Inline Markup */
/* ============= */

sup, sub { line-height: 0.8; } /* do not add leading for lines with sup/sub */

/* Inline Literals                                          */
/* possible values: normal, nowrap, pre, pre-wrap, pre-line */
/*   span.docutils.literal { white-space: pre-wrap; }       */

/* Hyperlink References */
a { text-decoration: none; }

/* External Targets       */
/*   span.target.external */
/* Internal Targets       */
/*   span.target.internal */
/* Footnote References    */
/*   a[role="doc-noteref"] */
/* Citation References    */
/*   a.citation-reference */

</style>
</head>
<body>
<main id="the-application-context">
<h1 class="title">The Application Context</h1>

<aside class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 1)</p>
<p>Unknown directive type &quot;currentmodule&quot;.</p>
<pre class="literal-block">.. currentmodule:: flask
</pre>
</aside>
<p>The application context keeps track of the application-level data during
a request, CLI command, or other activity. Rather than passing the
application around to each function, the <a href="#system-message-1"><span class="problematic" id="problematic-1">:data:`current_app`</span></a> and
<a href="#system-message-2"><span class="problematic" id="problematic-2">:data:`g`</span></a> proxies are accessed instead.</p>
<aside class="system-message" id="system-message-1">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 6); <em><a href="#problematic-1">backlink</a></em></p>
<p>Unknown interpreted text role &quot;data&quot;.</p>
</aside>
<aside class="system-message" id="system-message-2">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 6); <em><a href="#problematic-2">backlink</a></em></p>
<p>Unknown interpreted text role &quot;data&quot;.</p>
</aside>
<p>This is similar to <a href="#system-message-3"><span class="problematic" id="problematic-3">:doc:`/reqcontext`</span></a>, which keeps track of
request-level data during a request. A corresponding application context
is pushed when a request context is pushed.</p>
<aside class="system-message" id="system-message-3">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 11); <em><a href="#problematic-3">backlink</a></em></p>
<p>Unknown interpreted text role &quot;doc&quot;.</p>
</aside>
<section id="purpose-of-the-context">
<h2>Purpose of the Context</h2>
<p>The <a href="#system-message-4"><span class="problematic" id="problematic-4">:class:`Flask`</span></a> application object has attributes, such as
<a href="#system-message-5"><span class="problematic" id="problematic-5">:attr:`~Flask.config`</span></a>, that are useful to access within views and
<a href="#system-message-6"><span class="problematic" id="problematic-6">:doc:`CLI commands &lt;/cli&gt;`</span></a>. However, importing the <span class="docutils literal">app</span> instance
within the modules in your project is prone to circular import issues.
When using the <a href="#system-message-7"><span class="problematic" id="problematic-7">:doc:`app factory pattern &lt;/patterns/appfactories&gt;`</span></a> or
writing reusable <a href="#system-message-8"><span class="problematic" id="problematic-8">:doc:`blueprints &lt;/blueprints&gt;`</span></a> or
<a href="#system-message-9"><span class="problematic" id="problematic-9">:doc:`extensions &lt;/extensions&gt;`</span></a> there won't be an <span class="docutils literal">app</span> instance to
import at all.</p>
<aside class="system-message" id="system-message-4">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 18); <em><a href="#problematic-4">backlink</a></em></p>
<p>Unknown interpreted text role &quot;class&quot;.</p>
</aside>
<aside class="system-message" id="system-message-5">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 18); <em><a href="#problematic-5">backlink</a></em></p>
<p>Unknown interpreted text role &quot;attr&quot;.</p>
</aside>
<aside class="system-message" id="system-message-6">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 18); <em><a href="#problematic-6">backlink</a></em></p>
<p>Unknown interpreted text role &quot;doc&quot;.</p>
</aside>
<aside class="system-message" id="system-message-7">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 18); <em><a href="#problematic-7">backlink</a></em></p>
<p>Unknown interpreted text role &quot;doc&quot;.</p>
</aside>
<aside class="system-message" id="system-message-8">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 18); <em><a href="#problematic-8">backlink</a></em></p>
<p>Unknown interpreted text role &quot;doc&quot;.</p>
</aside>
<aside class="system-message" id="system-message-9">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 18); <em><a href="#problematic-9">backlink</a></em></p>
<p>Unknown interpreted text role &quot;doc&quot;.</p>
</aside>
<p>Flask solves this issue with the <em>application context</em>. Rather than
referring to an <span class="docutils literal">app</span> directly, you use the <a href="#system-message-10"><span class="problematic" id="problematic-10">:data:`current_app`</span></a>
proxy, which points to the application handling the current activity.</p>
<aside class="system-message" id="system-message-10">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 27); <em><a href="#problematic-10">backlink</a></em></p>
<p>Unknown interpreted text role &quot;data&quot;.</p>
</aside>
<p>Flask automatically <em>pushes</em> an application context when handling a
request. View functions, error handlers, and other functions that run
during a request will have access to <a href="#system-message-11"><span class="problematic" id="problematic-11">:data:`current_app`</span></a>.</p>
<aside class="system-message" id="system-message-11">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 31); <em><a href="#problematic-11">backlink</a></em></p>
<p>Unknown interpreted text role &quot;data&quot;.</p>
</aside>
<p>Flask will also automatically push an app context when running CLI
commands registered with <a href="#system-message-12"><span class="problematic" id="problematic-12">:attr:`Flask.cli`</span></a> using <span class="docutils literal">&#64;app.cli.command()</span>.</p>
<aside class="system-message" id="system-message-12">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 35); <em><a href="#problematic-12">backlink</a></em></p>
<p>Unknown interpreted text role &quot;attr&quot;.</p>
</aside>
</section>
<section id="lifetime-of-the-context">
<h2>Lifetime of the Context</h2>
<p>The application context is created and destroyed as necessary. When a
Flask application begins handling a request, it pushes an application
context and a <a href="#system-message-13"><span class="problematic" id="problematic-13">:doc:`request context &lt;/reqcontext&gt;`</span></a>. When the request
ends it pops the request context then the application context.
Typically, an application context will have the same lifetime as a
request.</p>
<aside class="system-message" id="system-message-13">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 42); <em><a href="#problematic-13">backlink</a></em></p>
<p>Unknown interpreted text role &quot;doc&quot;.</p>
</aside>
<p>See <a href="#system-message-14"><span class="problematic" id="problematic-14">:doc:`/reqcontext`</span></a> for more information about how the contexts work
and the full life cycle of a request.</p>
<aside class="system-message" id="system-message-14">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 49); <em><a href="#problematic-14">backlink</a></em></p>
<p>Unknown interpreted text role &quot;doc&quot;.</p>
</aside>
</section>
<section id="manually-push-a-context">
<h2>Manually Push a Context</h2>
<p>If you try to access <a href="#system-message-15"><span class="problematic" id="problematic-15">:data:`current_app`</span></a>, or anything that uses it,
outside an application context, you'll get this error message:</p>
<aside class="system-message" id="system-message-15">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 56); <em><a href="#problematic-15">backlink</a></em></p>
<p>Unknown interpreted text role &quot;data&quot;.</p>
</aside>
<aside class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 59)</p>
<p>Cannot analyze code. Pygments package not found.</p>
<pre class="literal-block">.. code-block:: pytb

    RuntimeError: Working outside of application context.

    This typically means that you attempted to use functionality that
    needed to interface with the current application object in some way.
    To solve this, set up an application context with app.app_context().
</pre>
</aside>
<p>If you see that error while configuring your application, such as when
initializing an extension, you can push a context manually since you
have direct access to the <span class="docutils literal">app</span>. Use <a href="#system-message-16"><span class="problematic" id="problematic-16">:meth:`~Flask.app_context`</span></a> in a
<span class="docutils literal">with</span> block, and everything that runs in the block will have access
to <a href="#system-message-17"><span class="problematic" id="problematic-17">:data:`current_app`</span></a>.</p>
<aside class="system-message" id="system-message-16">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 67); <em><a href="#problematic-16">backlink</a></em></p>
<p>Unknown interpreted text role &quot;meth&quot;.</p>
</aside>
<aside class="system-message" id="system-message-17">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 67); <em><a href="#problematic-17">backlink</a></em></p>
<p>Unknown interpreted text role &quot;data&quot;.</p>
</aside>
<pre class="literal-block">def create_app():
    app = Flask(__name__)

    with app.app_context():
        init_db()

    return app</pre>
<p>If you see that error somewhere else in your code not related to
configuring the application, it most likely indicates that you should
move that code into a view function or CLI command.</p>
</section>
<section id="storing-data">
<h2>Storing Data</h2>
<p>The application context is a good place to store common data during a
request or CLI command. Flask provides the <a href="#system-message-18"><span class="problematic" id="problematic-18">:data:`g object &lt;g&gt;`</span></a> for this
purpose. It is a simple namespace object that has the same lifetime as
an application context.</p>
<aside class="system-message" id="system-message-18">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 89); <em><a href="#problematic-18">backlink</a></em></p>
<p>Unknown interpreted text role &quot;data&quot;.</p>
</aside>
<aside class="admonition note">
<p class="admonition-title">Note</p>
<p>The <span class="docutils literal">g</span> name stands for &quot;global&quot;, but that is referring to the
data being global <em>within a context</em>. The data on <span class="docutils literal">g</span> is lost
after the context ends, and it is not an appropriate place to store
data between requests. Use the <a href="#system-message-19"><span class="problematic" id="problematic-19">:data:`session`</span></a> or a database to
store data across requests.</p>
<aside class="system-message" id="system-message-19">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 95); <em><a href="#problematic-19">backlink</a></em></p>
<p>Unknown interpreted text role &quot;data&quot;.</p>
</aside>
</aside>
<p>A common use for <a href="#system-message-20"><span class="problematic" id="problematic-20">:data:`g`</span></a> is to manage resources during a request.</p>
<aside class="system-message" id="system-message-20">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 101); <em><a href="#problematic-20">backlink</a></em></p>
<p>Unknown interpreted text role &quot;data&quot;.</p>
</aside>
<ol class="arabic">
<li><p><span class="docutils literal">get_X()</span> creates resource <span class="docutils literal">X</span> if it does not exist, caching it
as <span class="docutils literal">g.X</span>.</p></li>
<li><p><span class="docutils literal">teardown_X()</span> closes or otherwise deallocates the resource if it
exists. It is registered as a <a href="#system-message-21"><span class="problematic" id="problematic-21">:meth:`~Flask.teardown_appcontext`</span></a>
handler.</p>
<aside class="system-message" id="system-message-21">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 105); <em><a href="#problematic-21">backlink</a></em></p>
<p>Unknown interpreted text role &quot;meth&quot;.</p>
</aside>
</li>
</ol>
<p>For example, you can manage a database connection using this pattern:</p>
<pre class="literal-block">from flask import g

def get_db():
    if 'db' not in g:
        g.db = connect_to_database()

    return g.db

&#64;app.teardown_appcontext
def teardown_db(exception):
    db = g.pop('db', None)

    if db is not None:
        db.close()</pre>
<p>During a request, every call to <span class="docutils literal">get_db()</span> will return the same
connection, and it will be closed automatically at the end of the
request.</p>
<p>You can use <a href="#system-message-22"><span class="problematic" id="problematic-22">:class:`~werkzeug.local.LocalProxy`</span></a> to make a new context
local from <span class="docutils literal">get_db()</span>:</p>
<aside class="system-message" id="system-message-22">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 130); <em><a href="#problematic-22">backlink</a></em></p>
<p>Unknown interpreted text role &quot;class&quot;.</p>
</aside>
<pre class="literal-block">from werkzeug.local import LocalProxy
db = LocalProxy(get_db)</pre>
<p>Accessing <span class="docutils literal">db</span> will call <span class="docutils literal">get_db</span> internally, in the same way that
<a href="#system-message-23"><span class="problematic" id="problematic-23">:data:`current_app`</span></a> works.</p>
<aside class="system-message" id="system-message-23">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 136); <em><a href="#problematic-23">backlink</a></em></p>
<p>Unknown interpreted text role &quot;data&quot;.</p>
</aside>
</section>
<section id="events-and-signals">
<h2>Events and Signals</h2>
<p>The application will call functions registered with
<a href="#system-message-24"><span class="problematic" id="problematic-24">:meth:`~Flask.teardown_appcontext`</span></a> when the application context is
popped.</p>
<aside class="system-message" id="system-message-24">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 143); <em><a href="#problematic-24">backlink</a></em></p>
<p>Unknown interpreted text role &quot;meth&quot;.</p>
</aside>
<p>If <a href="#system-message-25"><span class="problematic" id="problematic-25">:data:`~signals.signals_available`</span></a> is true, the following signals are
sent: <a href="#system-message-26"><span class="problematic" id="problematic-26">:data:`appcontext_pushed`</span></a>, <a href="#system-message-27"><span class="problematic" id="problematic-27">:data:`appcontext_tearing_down`</span></a>, and
<a href="#system-message-28"><span class="problematic" id="problematic-28">:data:`appcontext_popped`</span></a>.</p>
<aside class="system-message" id="system-message-25">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 147); <em><a href="#problematic-25">backlink</a></em></p>
<p>Unknown interpreted text role &quot;data&quot;.</p>
</aside>
<aside class="system-message" id="system-message-26">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 147); <em><a href="#problematic-26">backlink</a></em></p>
<p>Unknown interpreted text role &quot;data&quot;.</p>
</aside>
<aside class="system-message" id="system-message-27">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 147); <em><a href="#problematic-27">backlink</a></em></p>
<p>Unknown interpreted text role &quot;data&quot;.</p>
</aside>
<aside class="system-message" id="system-message-28">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">/Users/bobobo/code/book/book-read-flask/chapters/appcontext.rst</span>, line 147); <em><a href="#problematic-28">backlink</a></em></p>
<p>Unknown interpreted text role &quot;data&quot;.</p>
</aside>
</section>
</main>
</body>
</html>
